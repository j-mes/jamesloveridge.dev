<!DOCTYPE html>
<html lang="en-GB">
	<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Test coverage | James Loveridge â€“ Software Engineer</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/css/main.css">
</head>

	<body>
		<header>
	<a href="/" title="James Loveridge â€“ Software Engineer"><span>James Loveridge â€“ Software Engineer</span></a>
</header>
		<main data-page="note">
			<article class="note__content">
				<h1 class="note__page-title">Test coverage</h1>
				<p>For the future meâ€¦</p>
<h2>Setting up test coverage</h2>
<p>To start with this is really dependent on which testing framework that a project will be using. This will cover both Jest and Ava/Mocha <em>(Future me will be using non-Facebook developed testing framework for side projects and for work projects go with the flow)</em>. <a href="https://www.coveralls.io">Coveralls</a> is free for open source projects so there's no hidden pricing. The only rule is to not make it a private repository. This article will cover Coveralls with CircleCI, other continuous integration pipelines may differ.</p>
<h3>General</h3>
<p>Start with installing the <a href="https://github.com/nickmerwin/node-coveralls">node-coveralls</a> production package as a development dependency that's available on <a href="https://www.npmjs.org">npm</a>.</p>
<pre><code>npm install node-coveralls --save-dev
</code></pre>
<p><strong>Note:</strong> This can be installed as <code>npm i -D node-coveralls</code> if using the shorthand syntax.</p>
<p>Add a new script task like this below, or if the future me decides to do it in a different way then that's OK too!</p>
<pre><code class="language-json">{
	...
	&quot;scripts&quot;: {
		&quot;test&quot;: &quot;&lt;your test framework command&gt;&quot;,
		&quot;test:coverage&quot;: &quot;&lt;test coverage command&gt;&quot;
	},
	...
}
</code></pre>
<p><strong>Note:</strong> The vague commands in the <code>test</code> and <code>test:coverage</code> will be covered by the respective test frameworks below.</p>
<h3>Ava / Mocha</h3>
<p>To start using either <a href="https://github.com/avajs/ava">AVA</a> or <a href="https://mochajs.org/">Mocha</a>, this will need the node production package called <a href="https://www.npmjs.com/package/nyc">nyc</a> (via npm). To sum up what <code>nyc</code> does. It is a package that counts the lines in the code, and then checks for tests that will cover the lines which has been written in the code that a project may have. More information about nyc and Istanbul can be found at <a href="https://istanbul.js.org/">IstanbulJS</a>.</p>
<ol>
<li>Install as a devDependency in the <code>package.json</code>.</li>
</ol>
<pre><code>npm install nyc --save-dev
</code></pre>
<ol start="2">
<li>Add the command to the <code>test:coverage</code> task inside the scripts object in the <code>package.json</code>.</li>
</ol>
<pre><code class="language-json">{
	...
	&quot;scripts&quot;: {
		&quot;test&quot;: &quot;&lt;ava or mocha command for tests&gt;&quot;,
		&quot;test:coverage&quot;: &quot;nyc npm test &amp;&amp; nyc report --reporter=text-lcov | coveralls&quot;
	}
	...
}
</code></pre>
<p>What this will do is with your <code>npm test</code> script, it will run either how the project has been set up with AVA or Mocha. The coverage is run concurrently with the tests at the same time. I'd suggest adding the following lines to the <code>.gitignore</code> file:</p>
<pre><code>.nyc_output
coverage
</code></pre>
<p>So that the <code>git</code> history is kept clean of auto-generated files, and this is not really needed on the repository.</p>
<h3>Jest</h3>
<p>Jest comes with its own built in coverage tool, so this requires one less dependency as it will not need <code>nyc</code>. To run the coverage with Jest and to upload to Coveralls, see below:</p>
<pre><code class="language-json">{
	...
	&quot;scripts&quot;: {
		&quot;test&quot;: &quot;&lt;jest command for tests&gt;&quot;,
		&quot;test:coverage&quot;:&quot;jest --coverage --coverageReporters=text-lcov | coveralls&quot;
	},
	...
}
</code></pre>
<h2>Useful links</h2>
<p>Read the documentation future me!</p>
<ol>
<li><a href="https://docs.coveralls.io/">Coveralls Documentation</a></li>
<li><a href="https://circleci.com/docs/">CircleCI Documentation</a></li>
</ol>
<p>Until then ðŸ‘‹</p>

				<span><em>21 February 2020</em></span>
				<hr />
				<a href="/" title="Return to homepage">Return to home</a>
			</article>
		</main>
		<footer>
	<ul>
		<li>
			<a href="//github.com/j-mes" rel="me">
				<svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
			</a>
		</li>
		<li>
			<a href="//hachyderm.io/@j_mes" rel="me">
				<svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24"><title>Mastodon</title><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/></svg>
			</a>
		</li>
		<li>
			<a href="//twitter.com/j_mes" rel="me">
				<svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24"><title>Twitter</title><path d="M21.543 7.104c.015.211.015.423.015.636 0 6.507-4.954 14.01-14.01 14.01v-.003A13.94 13.94 0 0 1 0 19.539a9.88 9.88 0 0 0 7.287-2.041 4.93 4.93 0 0 1-4.6-3.42 4.916 4.916 0 0 0 2.223-.084A4.926 4.926 0 0 1 .96 9.167v-.062a4.887 4.887 0 0 0 2.235.616A4.928 4.928 0 0 1 1.67 3.148 13.98 13.98 0 0 0 11.82 8.292a4.929 4.929 0 0 1 8.39-4.49 9.868 9.868 0 0 0 3.128-1.196 4.941 4.941 0 0 1-2.165 2.724A9.828 9.828 0 0 0 24 4.555a10.019 10.019 0 0 1-2.457 2.549z"/></svg>
			</a>
		</li>
	</ul>
</footer>

	</body>
</html>
